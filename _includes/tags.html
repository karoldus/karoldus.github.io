
{%- capture site_tags -%}
    {%- for project in site.projects -%}
        {%- for tag in project.tags -%}
            {{- tag -}}{%- unless forloop.last -%},{%- endunless -%}
        {%- endfor -%}
        {%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
{%- endcapture -%}
{%- assign all_tags = site_tags | split:',' | uniq | sort -%}

{%- for tag in all_tags -%}
    {%- assign tag_count = 0 -%}
    {%- for project in site.projects -%}
        {%- if project.tags contains tag -%}
            {%- assign tag_count = tag_count | plus: 1 -%}
        {%- endif -%}
    {%- endfor -%}
    <a href="#{{- tag -}}" class="btn btn-primary tag-btn">{% comment %}<i class="fas fa-tag" aria-hidden="true"></i>&nbsp;{% endcomment %}&nbsp;{{- tag -}}&nbsp;({{ tag_count }})</a>&nbsp;
{%- endfor -%}

<div id="full-tags-list">
{%- for tag in all_tags -%}
    {%- assign tag_count = 0 -%}
    {%- for project in site.projects -%}
        {%- if project.tags contains tag -%}
            {%- assign tag_count = tag_count | plus: 1 -%}
        {%- endif -%}
    {%- endfor -%}
    <h2 id="{{ tag }}" class="linked-section">
        {% comment %}<i class="fas fa-tag" aria-hidden="true"></i>&nbsp;{% endcomment %}
        {{- tag -}}&nbsp;({{ tag_count }})
    </h2>
    <div class="post-list">
        {%- for project in site.projects -%}
            {%- if project.tags contains tag -%}
            <div class="tag-entry">
                <p class="entry-date">
                    <a href="{{ project.url }}">{{- project.title | strip_html -}}</a> - {{ project.time_range }}
                </p>
            </div>
            {%- endif -%}
        {%- endfor -%}
    </div>
{%- endfor -%}
</div>

